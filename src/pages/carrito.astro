---
import Layout from "../layouts/Layout.astro";

//imagenes
import cartIcon from "../assets/cart-big.svg";
---

<Layout title="carrito">
    <style lang="scss">
        .container {
            width: 80%;
            margin: 0 auto;
            text-align: center;

            .titulo {
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 2rem 0;

                img {
                    width: 50px;
                    margin-right: 1rem;
                }
            }

            .tabla {
                table {
                    width: 100%;
                    border-collapse: collapse;
                    border: 4px solid #d9f0dd;

                    thead {
                        background-color: #d9f0dd;
                        color: #2d2d2d;
                        font-weight: 800;
                    }
                    th,
                    td {
                        padding: 1rem;
                        text-align: center;
                    }

                    tfoot {
                        background-color: #d9f0dd;
                        color: #2d2d2d;
                        font-weight: 800;
                    }
                }

                td {
                    padding: 2rem;
                }
            }

            .buttons {
                
                margin: 2rem 0;
                display: flex;
                justify-content: flex-end;

                .pagar {
                    display: block;
                    text-decoration: none;
                    color: #fff;
                    font-weight: 800;
                    padding: 1rem 2rem;
                    background-color: #7bad69;
                    border-radius: 2rem;
                    transition: background-color 200ms ease-in-out;

                    &:hover {
                        background-color: #5f8f4f;
                    }
                }

                .delete-products {
                    display: block;
                    text-decoration: none;
                    color: #fff;
                    font-weight: 800;
                    padding: 1rem 2rem;
                    margin-right: 1rem;
                    background-color: #f2224c;
                    border-radius: 2rem;
                    transition: background-color 200ms ease-in-out;

                    &:hover {
                        background-color: #d61e43;
                    }
                }

                .quantity-btn {
                    cursor: pointer;
                }
            }
        }
    </style>

    <div class="container">
        <div class="titulo">
            <img src={cartIcon} alt="" />
            <h1>Carrito</h1>
        </div>

        <!-- Tabla -->
        <div class="tabla">
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                    </tr>
                </thead>

                <tbody id="table">
                    <!-- Rows and columns -->
                </tbody>

                <tfoot>
                    <tr>
                        <td>Total</td>
                        <td id="total">$ 0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="buttons">
            <span class="delete-products" id="delete-productos">Eliminar productos</span>
            <span class="pagar" id="pagar">Pagar</span>
        </div>
    </div>

    <script>
        import { sendWhatsapp } from "../utils/integrations.js";
        import { getLocalStorage } from "../utils/localStorage.js";

        const table = document.getElementById("table");
        const botonPagar = document.getElementById("pagar");
        const addItem = document.getElementById("agregar");
        const total = document.getElementById("total");
        const price = document.getElementById("price");
        const deleteProductos = document.getElementById("delete-productos");

        // Get cart items from local storage
        const cartItem = getLocalStorage("Carrito");

        // Generate rows and columns
        for (let i = 0; i < cartItem.length; i++) {
            table.innerHTML += `
                <tr>
                    <td>${cartItem[i].name}</td>
                    <td id="price">${cartItem[i].price}</td>
                </tr>
            `;
        }

        // Update total value in base of the generated by js tr td, the td of price have an id of price
        const prices = document.querySelectorAll("#price");
        let totalValue = 0;
        prices.forEach((price) => {
            totalValue += Number(price.textContent);
        });

        // Update total value
        total.textContent = `s/. ${totalValue}`;

        // Send whatsapp message
        botonPagar.addEventListener("click", () => {
            sendWhatsapp(
                "51935463517",
                `
                Hola, quiero comprar los siguientes productos:
                ${cartItem.map((item) => {
                    return `${item.name} - s/. ${item.price}`;
                })}
                Total: s/. 1${totalValue}
            `
            );
        });

        // Delete products
        deleteProductos.addEventListener("click", () => {
            localStorage.removeItem("Carrito");
            location.reload();
        });

    </script>
</Layout>
