---
// Layout
import Layout from "../layouts/Layout.astro";

// Assets
import sachaJergonImg from "../assets/jergon-sacha-en-polvo-amazon-fruit-web.jpg";
---

<Layout title="Ver producto">
    <style lang="scss">
        @use "../styles/variables/metrics";
        @use "../styles/variables/colors";

        .container {
            max-width: metrics.$container-max-width;
            margin: 4rem auto;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            grid-column-gap: 1rem;

            .text {
                .product-title {
                    font-weight: 400;
                    margin-bottom: 1rem;
                }

                .product-price-title {
                    font-size: 24px;
                    display: block;
                    margin-block-end: 1rem;
                }

                .product-about-title {
                    font-size: 18px;
                    font-weight: 600;
                    margin-bottom: 1rem;
                }

                .product-about-description {
                    p {
                        margin-block-end: 1rem;
                    }
                }

                .buttons {
                    display: flex;
                    max-width: fit-content;
                    gap: 1rem;

                    .add-button {
                        cursor: pointer;
                        padding: 0.5rem 1rem;
                        border-radius: 0.5rem;
                        background-color: colors.$color-100;
                        color: colors.$white;
                    }
                }
            }

            aside {
                border: 2px solid #20202050;
                border-radius: 0.5rem;
                padding: 1.5rem;
                height: fit-content;

                .aside-status-title {
                    font-size: 18px;
                    font-weight: 500;
                    margin-block-end: 1.2rem;
                }

                .aside-buy-link {
                    margin: auto;
                }
            }
        }

        .modal {
            display: none;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: hsla(0, 0%, 0%, 0.5);

            &.visible {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .content {
                border-radius: 0.5rem;
                background-color: white;
                max-width: 60ch;
                padding: 2rem;

                .header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 1rem;

                    .modal-close {
                        cursor: pointer;
                        display: block;
                        text-align: right;
                    }
                }

                form {
                    display: flex;
                    flex-direction: column;

                    & > * {
                        margin-bottom: 1rem;
                    }

                    input[type="number"],
                    input[type="number"]:focus,
                    input[type="number"]:focus-visible {
                        padding: 0.5rem 1rem;
                        border: none;
                        border-radius: 0.3rem;
                        font-family: monospace;
                        font-size: 1rem;
                        background-color: hsla(0, 0%, 0%, 0.1);
                    }

                    button {
                        padding: 0.5rem 1rem;
                        border: none;
                        font-family: inherit;
                        border-radius: 0.3rem;
                        background-color: colors.$logotype;
                        color: colors.$white;
                        margin-bottom: 0;
                        font-weight: 600;
                    }
                }
            }
        }
    </style>

    <div class="container">
        <img src={sachaJergonImg} alt="Galletas de Sacha Jergon" />

        <div class="text">
            <h1 class="product-title">Galletas Sacha Jergón</h1>

            <span class="product-price-title">s/. 9.99</span>

            <h2 class="product-about-title">Sobre este artículo</h2>

            <section class="product-about-description">
                <p>
                    ¿Qué hace a nuestras galletas tan especiales? El Sacha
                    Jergón, una planta amazónica llena de propiedades
                    saludables, es el ingrediente estrella. Estas galletas son
                    una fuente natural de energía, proporcionándote el impulso
                    necesario para afrontar tu día.
                </p>
                <p>
                    Además, el Sacha Jergón contiene antioxidantes poderosos que
                    ayudan a fortalecer tu sistema inmunológico y proteger tu
                    cuerpo contra los radicales libres. ¡Una manera deliciosa de
                    cuidar de ti mismo!
                </p>
            </section>

            <div class="buttons">
                <span class="add-button" id="open-modal">
                    Agregar al carrito
                </span>
            </div>
        </div>

        <aside>
            <h3 class="aside-status-title">Estado: En stock</h3>

            <section class="aside-description">
                <p>
                    Enviós a todas las partes del Perú. Los envíos locales son
                    gratuitos.
                </p>
            </section>
        </aside>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="content">
            <div class="header">
                <h3>Antes de proceder...</h3>

                <span
                    role="button"
                    id="close-modal"
                    class="modal-close material-symbols-outlined"
                >
                    close</span
                >
            </div>
            <form>
                <label for="cantidad"
                    >¿Cuantas galletas deseas comprar? (Máximo de 10)</label
                >
                <input type="number" name="cantidad" id="amount" max="10" value="1" />
                <p>Total: s/. <span id="amount-selected">0</span></p>
                <button id="add-to-cart">Agregar</button>
            </form>
        </div>
    </div>
</Layout>

<script>
    import { addLocalStorage } from "../utils/localStorage.js";

    const modal = document.getElementById("modal");
    const openModal = document.getElementById("open-modal");
    const closeModal = document.getElementById("close-modal");
    const amount = document.getElementById("amount");
    const amountSelected: any = document.getElementById("amount-selected");
    const addToCart = document.getElementById("add-to-cart");
    const form = document.querySelector("form");

    // Prevent default behaviour
    form.addEventListener("submit", (e) => {
        e.preventDefault();
    });

    // Abre el modal
    openModal.addEventListener("click", (e) => {
        modal.classList.add("visible");
    });

    // Cierra el modal
    closeModal.addEventListener("click", (e) => {
        modal.classList.remove("visible");
    });

    // Cierra el modal al hacer click fuera de el
    window.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.classList.remove("visible");
        }
    });

    // Actualiza el total de galletas seleccionadas
    amount.addEventListener("input", (e) => {
        amountSelected.textContent = e.target.value * 9.99;
    });

    // Agrega el producto al carrito
    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const product = {
            name: "Galletas Sacha Jergón",
            price: 9.99,
        };

        // Max amount is 10
        if (amount.value > 10 || amount.value < 1) {
            return;
        }

        for (let i = 0; i < amount.value; i++) {
            addLocalStorage("Carrito", product);
        }

        // Change the button text to "Agregado"
        addToCart.textContent = "Agregado";

        setTimeout(() => {
            modal.classList.remove("visible");
        }, 3000);
    });
</script>
